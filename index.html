<html> 
<head> 
<title>tunnel7000</title> 
<style>
  body { background-color:0; } 
  canvas { width: 100%; height: 100% }
  #menu { background-color: #666666; color: white; }
</style> 

<script id="fragmentShader" type="x-shader/x-fragment">

#ifdef GL_ES
precision highp float;
#endif

#define pi 3.14159

uniform vec2 resolution;
uniform float time;
uniform sampler2D tex0;
uniform vec2 tunnelCenter;
//uniform sampler2D tex1;

void main(void)
{
    //vec2 p = -1.0 + 2.0 * gl_FragCoord.xy / resolution.xy;
    //p.x -= 1.0;

    vec2 p = vec2(
	tunnelCenter.x + 2.0 * gl_FragCoord.x / resolution.x,
	tunnelCenter.y + 2.0 * gl_FragCoord.y / resolution.y
	);

    float r = sqrt(dot(p,p));
    float a = atan(p.y,p.x); // + 0.5*sin(0.5*r-0.5*time);


    // normal tunnel

    vec2 uv;
    uv = vec2(cos(a) / r, sin(a) / r);
    uv.y += time*0.1;
    uv.x += time*0.25;
    vec3 col1 = texture2D(tex0,uv).xyz;

    uv = vec2(sin(a) / r, cos(a) / r);
    uv.y += time*0.1;
    uv.x += time*0.25;
    vec3 col2 = texture2D(tex0,uv).xyz;

    // alpha blend
    //vec3 col = mix(col1, col2, 0.5); // overlay
    //vec3 col = 1.0 - (1.0-col1)*(1.0-col2); // screen
    vec3 col = col1*col2; // multiply

    gl_FragColor = vec4(col*0.5*r*r,1.0);
}


</script>

<script id="vertexShader" type="x-shader/x-vertex">
    varying vec2 t;
  varying vec2 pos;
  
  void main() {
      vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );
      gl_Position = projectionMatrix * mvPosition;
      t = uv;
      pos = vec2(position.x, position.y);
  }
</script>

</head> 
<body onLoad="init()">
  <div id="glcontainer" style="width:640px;height:480px;left:0px;top:0px;position:relative;"></div>
  <div id="menu">
    cx: <input id="tunnelCx" type="range" min="-2.0" max="2.0" step="0.01" value="1.5" onchange="updateTunnelCenter()" />    
    cy: <input id="tunnelCy" type="range" min="-2.0" max="2.0" step="0.01" value="-1.5" onchange="updateTunnelCenter()" />    
  </div>
  <script src="three.min.js"></script> 
  <script src="tunnel7000.js"></script>
</body> 
</html>
